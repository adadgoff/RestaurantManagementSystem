# Правила поварского клуба

1. Если блюдо начали готовить, оно будет доведено до конца;
2. При отмене заказа все блюда готовятся до конца и вычитаются из количества. Что делать с наполовину готовой едой? Не
   выбрасывать же, потом сотрудники поделят. :)
3. FIFO (First In First Out);
4. Все посетители адекватные, никто не заказывает столько, сколько не сможет съесть;
5. Для банкетов, когда у одного заказчика миллион блюд, предусмотрены отдельные дни.
6. Не надо обрывать работу сервера посередине приготовления блюд (можно это учесть, например при запуске переносит все
   waiting и cooking блюда в cooked, но надо делать ещё курсовую + другие предметы);

# Логика создания заказа

# Галя, у нас отмена

При отмене заказа надо пересобрать очередь:

1. Удалить заказ из очереди;
2. Все полуприготовленные блюда (которые уже готовятся) доготовить;
3. Все `cookingDishes == waitingDishes` отмененного заказа надо вернуть в БД;

У заказа есть только три состояния:

- `Готовится`;
- `Готов`;
- `Отменён`.

```
Надо работать с БД асинхронно и потокобезопасно... :)
```

- При создании заказа в БД `orders` добавляется запись:

| id                 | cooking_dishes                                               | cooked_dishes | cost                      | start_time    | end_time | status      |
|--------------------|--------------------------------------------------------------|---------------|---------------------------|---------------|----------|-------------|
| Сгенерированный Id | Все заказанные блюда (ВАЖНО: могут быть повторяющиеся блюда) | `NULL`        | стоимость заказанных блюд | текущее время | `NULL`   | `Готовится` |

- При добавлении блюда в заказ в БД `orders` обновляется запись:

| id        | cooking_dishes                                                            | cooked_dishes         | cost                                           | start_time          | end_time | status      |
|-----------|---------------------------------------------------------------------------|-----------------------|------------------------------------------------|---------------------|----------|-------------|
| Id заказа | Добавляется id добавленного блюда (ВАЖНО: могут быть повторяющиеся блюда) | \*Текущее состояние\* | старая стоимость + стоимость заказанного блюда | Время начала заказа | `NULL`   | `Готовится` |

- Когда какое-то блюдо готово, обновляется запись в БД `orders`:

| id        | cooking_dishes                                                           | cooked_dishes             | cost                       | start_time   | end_time | status      |
|-----------|--------------------------------------------------------------------------|---------------------------|----------------------------|--------------|----------|-------------|
| Id заказа | Удаляется одно id готового блюда (ВАЖНО: могут быть повторяющиеся блюда) | Добавляется готовое блюдо | Старое время начала заказа | старое время | `NULL`   | `Готовится` |

- Когда все блюда готовы (пустой cooking_dishes), обновляется запись в БД `orders`, проверка после каждого
  приготовленного блюда:

| id        | cooking_dishes             | cooked_dishes    | cost                  | start_time                 | end_time          | status                     |
|-----------|----------------------------|------------------|-----------------------|----------------------------|-------------------|----------------------------|
| Id заказа | \*Здесь становится пусто\* | Все блюда готовы | стоимость не меняется | Старое время начала заказа | Обновляется время | Меняется статус на `Готов` |

- Когда заказ отменяют, обновляется запись в БД `orders`:

| id                 | cooking_dishes        | cooked_dishes         | cost                      | start_time                 | end_time          | status                       |
|--------------------|-----------------------|-----------------------|---------------------------|----------------------------|-------------------|------------------------------|
| Сгенерированный Id | \*Текущее состояние\* | \*Текущее состояние\* | стоимость заказанных блюд | Старое время начала заказа | Обновляется время | Меняется статус на `Отменён` |


